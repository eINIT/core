<einit prefix="services-virtual-module">
<!-- creds to Tyrius for this one =) -->
 <shell id="shell-clamd"
  name="clamd - AntiVirus"
  provides="antivirus:clamd"
  requires="network-minimal:mount-critical"
  prepare="local clamd_socket=$(awk '$1 == &quot;LocalSocket&quot; { print $2 }' /etc/clamd.conf);
           logfile=$(awk '$1 == &quot;LogFile&quot; { print $2 }' /etc/clamd.conf);
           clamav_user=$(awk '$1 == &quot;User&quot; { print $2 }' /etc/clamd.conf);
           if [[ -n &quot;${logfile}&quot; &amp;&amp; -n &quot;${clamav_user}&quot; ]]; then 
           	if [ ! -f &quot;${logfile}&quot; ]; then
           		touch ${logfile};
           	fi;
           	chown ${clamav_user} ${logfile};
           fi;
           if [ -S &quot;${clamd_socket:-/tmp/clamd}&quot; ]; then
           	rm -f ${clamd_socket:-/tmp/clamd};
           fi;"
  enable="/usr/sbin/clamd"
  disable="killall clamd" />
</einit>
