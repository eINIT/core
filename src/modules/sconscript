Import(['env', 'InstallDirModules', 'InstallDirBootstrap', 'Modules', 'ModulesLinux', 'ModulesCompatibility', 'ExternalModules'])

env.Append (CPPPATH = ['../include']);

def buildModule(name, location, e):
 e.Install(InstallDirModules, e.LoadableModule(name, location + '/' + name + '.c', CCFLAGS = '-DEINIT_MODULE', SHLIBPREFIX = ''))

def buildModuleBootStrap(name, e):
 e.Install(InstallDirBootstrap, e.LoadableModule(name, name + '.c', CCFLAGS = '-DEINIT_MODULE', SHLIBPREFIX = ''))

buildModuleBootStrap('bootstrap-configuration-stree', env)
buildModuleBootStrap('bootstrap-configuration-xml-expat', env.Clone (LIBS = 'expat-local', LIBPATH=['#expat']))

for x in Modules:
 buildModule(x, '.', env)

for x in ModulesLinux:
 buildModule(x, 'linux', env)

for x in ModulesCompatibility:
 buildModule(x, 'compatibility', env)

if 'ipc-9p' in ExternalModules:
 buildModule ('ipc-9p', '.', env.Clone (CPPPATH=['#libixp'], LIBS=['ixp-local'], LIBPATH=['#libixp']))
