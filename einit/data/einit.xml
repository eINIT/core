<?xml version="1.0" encoding="UTF-8" ?>
<einit>
 <core>
  <settings>
   <xml-parser>
    <auto-create-missing-directories b="true" />
   </xml-parser>
   <configuration>
    <if match="core-mode:sandbox">
     <on-line-modifications save-to="etc/einit/local/on-line-modifications.xml" />
     <else>
      <on-line-modifications save-to="/etc/einit/local/on-line-modifications.xml" />
     </else>
    </if>
   </configuration>
  </settings>

  <scheduler>
   <shutdown-function-suffixes s="linux" />
  </scheduler>

  <settings>
<!-- example: use this to disable the compatibility modules -->
<!-- <modules id="primus" path="/lib/einit/modules" pattern-allow=".*\.so" pattern-disallow="^compatibility.*" /> -->
   <modules id="primus" path="/lib/einit/modules" pattern-allow=".*\.so" />
  </settings>

  <if match="core-mode:sandbox">
   <module-logic>
    <init.d-path s="etc/einit/init.d/" />
    <maintain-init.d s="../../../lib/einit/scripts/einit.d_erc.sh" b="true" />
   </module-logic>

   <settings>
    <configuration-path s="etc/einit/" />
   </settings>
   <commands-include>
    <file s="sandbox.xml" />
    <file s="network.xml" />
    <file s="fstab.xml" />
    <file s="modes.xml" />
   </commands-include>
   <else>
    <module-logic>
     <init.d-path s="/etc/einit/init.d/" />
     <maintain-init.d s="/lib/einit/scripts/einit.d_erc.sh" b="true" />
    </module-logic>

    <settings>
     <configuration-path s="/etc/einit/" />
    </settings>
    <commands-include>
     <file s="local.xml" />
     <file s="network.xml" />
     <file s="fstab.xml" />
     <file s="modes.xml" />
    </commands-include>
   </else>

   <commands-include>
    <directory path="/etc/einit/conf.d" />
    <directory path="/etc/einit/subsystems.d" />
    <directory path="/etc/einit/local" />
    <directory path="/etc/einit/modules" />

    <directory path="/lib/einit/modules-xml" />
    <directory path="/lib/einit/modules-xml/network" />
   </commands-include>
  </if>

<!-- These settings control the "error correction" settings, i.e. how likely
     einit is to kill itself over a (potentially recoverable) problem.
     255 always means "kill yourself", 0 always means "ignore it". The values
     in between indicate different levels of actions, 1 should be "warn about
     it on stderr"
     Default is to print a warning and continue. Don't forget: if einit dies
     or exits for whatever reason, and it's being used as "the init" then most
     kernels will panic and your system will die, so setting most of these to
     255 is probably a very, very bad idea. -->
  <mortality>
   <bad-malloc i="1" />
   <bad-stdio i="1" />
   <bad-regex i="1" />
   <bad-expat i="1" />
   <bad-dl i="1" />
   <bad-lookup i="1" />
   <bad-pthreads i="1" />
  </mortality>
<!--  <mode s="init" /> -->
 </core>
 <configuration>
<!-- A note on the configuration variables in this file: If it appears in this file, and it also
   appears in local.xml (or whatever overlay you're loading), then the definition in local.xml
   will take preference (unless it's something where all entries are loaded, like fstab-nodes).
   i.e.: you do not need to modify the entries in both files, only the one in local.xml! -->
  <system>
   <ctrl-alt-del b="disabled" />
   <daemon-spawn-timeout i="20" />
   <daemon-term-timeout-primary i="10" />
   <daemon-term-timeout-secondary i="2" />
   <shell s="/bin/sh -c" />
   <shell-exec-timeout i="20" />
   <exec-envfile-base s="/etc/einit/conf.d" />
   <proc-path s="/proc" />
   <log b="true" s="/var/log/einit.log" />

   <kexec-to-reboot b="no" />
   <kexec-calls
     load="/usr/sbin/kexec -l ${kernel-image} --append=&quot;${kernel-options}&quot;"
     load-initrd="/usr/sbin/kexec -l ${kernel-image} --append=&quot;${kernel-options}&quot; --initrd=&quot;${kernel-initrd}&quot;"
     execute="/usr/sbin/kexec -e" />
  </system>

  <environment>
   <global id="PATH" s="/bin:/sbin:/usr/bin:/usr/sbin" />
   <global id="TERM" s="linux" />
   <safe PATH="/bin:/sbin:/usr/bin:/usr/sbin" TERM="dumb" />
  </environment>

  <kernel>
   <modules>
    <autoload.d file="/etc/modules.autoload.d/kernel-2.6" />
   </modules>
  </kernel>

  <network>
   <dhcp>
    <timeout s="60"/>
   </dhcp>
  </network>

  <feedback>
   <visual>
    <std-io stdio="/dev/tty9" stderr="/dev/tty11" console="/dev/tty12" activate-vt="9" kernel-vt="12" />
<!-- better verbosity on tty10: -->
<!--    <std-io stdio="/dev/tty1" stderr="/dev/tty11" console="/dev/tty12" activate-vt="1" kernel-vt="12" verbose-output="/dev/tty10" /> -->
    <use-ansi-codes b="true" />
    <shutdown-failure-timeout i="3" />
    <broadcast-constraints s="/dev/(tty[1-8][12]?|pts/.*)" />
    <reset-shutdown-broadcast-messages b="true" />

    <suppress-messages b="no" />
    <suppress-status-notices b="no" />

    <fbsplash>
     <ttys s="1 2 3 4 5 6" />
     <theme s="gentoo" />
     <chain-feedback s="feedback-textual" />
    </fbsplash>
   </visual>

   <visual-edje>
    <theme-path s="etc/einit/edje" />
    <theme-default s="einit.edj" />
    <theme-default-component s="einit/splash" />
   </visual-edje>

   <aural>
    <tts>
     <synthesizer-command s="/usr/bin/festival --tts --pipe" />
     <vocalising-threshold i="6" />
    </tts>
   </aural>
  </feedback>

  <ipc>
   <control-socket s="/dev/einit-control" i="0600" />
   <chain-command for="^update configuration.*" do="examine configuration" />

   <dbus>
    <connection address="unix:path=/var/run/dbus/system_bus_socket" name="org.einit.Einit" />
   </dbus>
  </ipc>

  <command>
<!-- the command to run to remove a module from the kernel -->
   <rmmod s="/sbin/modprobe -r" with-env="/sbin/modprobe -r ${module}" />
   <modprobe s="/sbin/modprobe" with-env="/sbin/modprobe ${module}" />

   <ip-flush with-env="ip addr flush dev ${interface}" />
   <create-bridge with-env="brctl addbr ${interface}" />
  </command>

 </configuration>

 <services>
  <virtual>
   <module>
<!-- modules -->
    <shell id="shell-kern-module-autoload.d"
     name="Kernel Modules (autoload.d)"
     provides="kern-arbitrary"
     requires="mount-system:ipc"
     enable="
      if test -e ${configuration_kernel_modules_autoload_d_file}; then
       modules=`grep -E '^\s*\w+' ${configuration_kernel_modules_autoload_d_file}`;
       for x in ${modules};
        do echo $x; modprobe $x &amp;
       done; /bin/true;
      else
       /bin/false;
      fi;"
     disable="
      if test -e ${configuration_kernel_modules_autoload_d_file}; then
       modules=`grep -E '^\s*\w+' ${configuration_kernel_modules_autoload_d_file}`;
       for x in ${modules}; do
        ${configuration_command_rmmod} $x &amp;
       done; /bin/true;
      else
       /bin/false;
      fi;"
     variables="configuration-kernel-modules-autoload.d/file:configuration-command-rmmod" />

    <shell id="shell-apache2"
     name="httpd - Apache Hypertext Transfer Protocol Server"
     provides="apache2"
     requires="mount-critical:net-lo"
     pid="/var/run/apache2.pid"
     opts="-D DEFAULT_VHOST"
     root="/usr/lib/apache2"
     config="/etc/apache2/httpd.conf"
     prepare="[ ! -e /var/log/apache2 ] &amp;&amp; mkdir /var/log/apache2;
              [ -f /var/log/apache2/ssl_scache ] &amp;&amp; rm /var/log/apache2/ssl_scache;
              /bin/true;"
     enable="pexec-options no-pipe; apache2 ${opts} -d ${root} -f ${config} -k start&amp;"
     disable="killall -9 -q apache2"
     restart="yes" />

<!-- this one's the version as modified by jvale to suit gentoo's environment -->
    <shell id="shell-apache2-gentoo"
     name="httpd - Apache Hypertext Transfer Protocol Server"
     provides="apache2"
     requires="mount-critical:net-lo"
     pid="/var/run/apache2.pid"
     envfile="/etc/conf.d/apache2"
     root="/usr/lib/apache2"
     config="/etc/apache2/httpd.conf"
     prepare="[ ! -e /var/log/apache2 ] &amp;&amp; mkdir /var/log/apache2;
              [ -f /var/log/apache2/ssl_scache ] &amp;&amp; rm /var/log/apache2/ssl_scache;
              /bin/true"
     enable="pexec-options no-pipe; apache2 $APACHE2_OPTS -d ${root} -f ${config} -k start&amp;"
     disable="killall -9 -q apache2"
     restart="yes" />

   </module>
  </virtual>
  <alias>
   <mount-system group="fs-root:fs-sys:fs-proc:udev" seq="most" />
   <samba group="nmbd:smbd" seq="all" />
   <network-minimal group="fqdn:net-lo" seq="most" />
  </alias>
  <prefer>
   <kern-alsa s="shell-kern-audio-alsa" />
   <feedback s="feedback-visual-textual" />
   <logger s="daemon-metalog:daemon-syslog-ng:daemon-syslog" />
  </prefer>
 </services>
</einit>
