<einit prefix="services-virtual-network">
 <ifctl id="wpa_supplicant"
  requires="kern-${interface}" $(wpa_cli -i ${interface} status | sed -n -e 's/^\(key_mgmt\)=\([^=]\+\).*/\U\&quot;\2\&quot;/p')
  enable="while ! [ -d /sys/class/net/${interface} ]; do sleep .1; done; i=0;
          wpa_supplicant -D ${configuration_network_interfaces_${interface}_driver} -i ${interface} -c ${configuration_network_interfaces_${interface}_config} &amp;&gt;/dev/null &amp;
          while [ '$(wpa_cli -i ${interface} status | sed -n -e 's/^\(key_mgmt\)=\([^=]\+\).*/\U\&quot;\2\&quot;/p')' != 'COMPLETE' ]; do
	   if [ '${i}' == '0' ]; then
	    echo -n 'waiting for interface...'; i=1;
	   fi; sleep .5; 
	  done&amp;"
  disable="wpa_cli -p /var/run/wpa_supplicant -i ${interface} terminate"
  variables="configuration-network-interfaces-${interface}/.*" />
</einit>
