<einit prefix="services-virtual-module">
 <shell-template id="template-shell-ifctl-wpa_supplicant"
  name="Using 'wpa_supplicant' to manage interface ${interface}"
  provides="ifctl-${interface}"
  prepare="sleep 3"
  enable="pexec-options no-pipe; wpa_supplicant -D ${configuration_network_interfaces_${interface}_driver} -i ${interface} -c ${configuration_network_interfaces_${interface}_config} -w -B;
          wpa_cli -i ${interface} -B; status=$(wpa_cli status | grep wpa_state | sed -e 's/.*wpa_state=//');
	  while [[ $status != COMPLETED ]];
           do sleep .1; status=$(wpa_cli status | grep wpa_state | sed -e 's/.*wpa_state=//');
          done; /bin/true"
  disable="wpa_cli terminate"
  variables="configuration-network-interfaces-${interface}/.*" />
</einit>
