<einit prefix="services-virtual-module">
 <shell id="shell-udev"
  name="udev - dynamic device management"
  provides="mount-system"
  requires="sysfs:proc"
  enable="pexec-options dont-close-stdin no-pipe;
	  echo &quot;feedback|notice|Mounting /dev for udev&quot;;
	  mount -n -t tmpfs -o exec,nosuid,mode=0755 udev /dev;
	  echo &quot;feedback|notice|Seeding /dev with needed nodes&quot;;
          [ ! -c /dev/console ] &amp;&amp; mknod /dev/console c 5 1;
          [ ! -c /dev/tty1 ] &amp;&amp; mknod /dev/tty1 c 4 1;
          [ ! -c /dev/null ] &amp;&amp; mknod /dev/null c 1 3;
          ln -snf /proc/self/fd /dev/fd;
          ln -snf fd/0 /dev/stdin;
          ln -snf fd/1 /dev/stdout;
          ln -snf fd/2 /dev/stderr;
          [ -e /proc/kcore ] &amp;&amp; ln -snf /proc/kcore /dev/core;
          mkdir -p /dev/pts /dev/shm;
          if [ -e /proc/sys/kernel/hotplug ]; then
      	   echo &quot;feedback|notice|Setting up proper hotplug agent&quot;;
           if [ $(uname -r | cut -f 3 -d . | cut -f 1 -d -) -gt 14 ]; then
   	    echo &quot;feedback|notice|Using netlink for hotplug events...&quot;;
            echo &quot;&quot; > /proc/sys/kernel/hotplug;
           else
	    echo &quot;feedback|notice|Setting /sbin/udevsend as hotplug agent ...&quot;;
            echo &quot;/sbin/udevsend&quot; > /proc/sys/kernel/hotplug;
           fi;
          fi;
	  echo &quot;feedback|notice|Starting udevd&quot;;
          udevd --daemon;
          touch /dev/.udev_populate;
          if [ $(uname -r | cut -f 3 -d . | cut -f 1 -d -) -gt 14 ]; then
	   echo &quot;feedback|notice|Populating /dev with existing devices through uevents&quot;;
           local opts=;
           [ &quot;${RC_COLDPLUG}&quot; != &quot;yes&quot; ] &amp;&amp; opts=&quot;--attr-match=dev&quot;;
           udevtrigger ${opts};
          else
	   echo &quot;feedback|notice|Populating /dev with existing devices with udevstart&quot;;
           udevstart;
          fi;
	  echo &quot;feedback|notice|Letting udev process events&quot;;
          udevsettle --timeout=60;
          rm -f /dev/.udev_populate"
  disable="killall -9 udevd"
  restart="yes" />
</einit>
