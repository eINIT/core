<einit prefix="services-virtual-module">
 <shell id="shell-ipw3945d"
  name="ipw3945d - regulatory daemon"
  provides="ipw3945d"
  requires="mount-critical"
  group="ipw3945d"
  pid="/var/run/ipw3945d.pid"
  prepare="chown ipw3945d /sys/bus/pci/drivers/ipw3945/00*/cmd;
           chmod a-w,u+rw /sys/bus/pci/drivers/ipw3945/00*/cmd"
  enable="pexec-options no-pipe;
	  STATE=$(cat /proc/modules | grep ipw3945 | awk '{print $3}');
	  while [ &quot;$STATE&quot; = &quot;0&quot; ]; do
	   modprobe -r -i ipw3945; modprobe -i ipw3945;
	   ipw3945d --quiet; sleep 1;
	   STATE=$(cat /proc/modules | grep ipw3945 | awk '{print $3}');
	  done; sleep 1"
  disable="killall -9 ipw3945d"
  restart="yes" />
</einit>
